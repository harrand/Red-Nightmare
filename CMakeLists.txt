cmake_minimum_required(VERSION 3.9)

configure_file(version.txt version_txt_dummy.xml)
file(READ version.txt GAME_VERSION_TXT)
string(REGEX MATCH "[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+" GAME_VERSION ${GAME_VERSION_TXT})

project(RedNightmare
	DESCRIPTION "2D Action Roguelike"
	LANGUAGES CXX
	VERSION ${GAME_VERSION})

add_subdirectory(engine)
add_subdirectory(lib)

tz_add_library(
	TARGET rnlib
	SOURCES
		src/gamelib/core/entity.cpp
		src/gamelib/core/entity.hpp
		src/gamelib/core/entity.inl
		src/gamelib/core/mount.hpp
		src/gamelib/core/transform.cpp
		src/gamelib/core/transform.hpp

		src/gamelib/gameplay/actor/components/animation.hpp
		src/gamelib/gameplay/actor/components/keyboard_control.hpp
		src/gamelib/gameplay/actor/components/sprite.hpp
		src/gamelib/gameplay/actor/entity.cpp
		src/gamelib/gameplay/actor/entity.hpp
		src/gamelib/gameplay/actor/system.cpp
		src/gamelib/gameplay/actor/system.hpp

		src/gamelib/render/animation.cpp
		src/gamelib/render/animation.hpp
		src/gamelib/render/camera.cpp
		src/gamelib/render/camera.hpp
		src/gamelib/render/font.cpp
		src/gamelib/render/font.hpp
		src/gamelib/render/image.cpp
		src/gamelib/render/image.hpp
		src/gamelib/render/quad_renderer.cpp
		src/gamelib/render/quad_renderer.hpp
		src/gamelib/render/scene_renderer.cpp
		src/gamelib/render/scene_renderer.hpp
		src/gamelib/render/text_renderer.cpp
		src/gamelib/render/text_renderer.hpp

		src/gamelib/game.cpp
		src/gamelib/game.hpp
		src/gamelib/version.cpp
		src/gamelib/version.hpp
)
target_include_directories(rnlib PUBLIC ${PROJECT_SOURCE_DIR}/src)

add_shader(
	TARGET rnlib
	SHADERS
	src/gamelib/render/shaders/empty.vertex.tzsl
	src/gamelib/render/shaders/empty.fragment.tzsl
	src/gamelib/render/shaders/quad.vertex.tzsl
	src/gamelib/render/shaders/quad.fragment.tzsl
	src/gamelib/render/shaders/text.vertex.tzsl
	src/gamelib/render/shaders/text.fragment.tzsl

	src/gamelib/render/shaders/effects/layer.vertex.tzsl
	src/gamelib/render/shaders/effects/layer.fragment.tzsl
	src/gamelib/render/shaders/effects/precipitation.vertex.tzsl
	src/gamelib/render/shaders/effects/precipitation.fragment.tzsl
)

target_link_libraries(rnlib PUBLIC stb freetype)
target_compile_definitions(rnlib PUBLIC -DGAME_VERSION=0x${PROJECT_VERSION_MAJOR}${PROJECT_VERSION_MINOR}${PROJECT_VERSION_PATCH}${PROJECT_VERSION_TWEAK})

add_text(
	TARGET rnlib
	INPUT_DIR ${PROJECT_SOURCE_DIR}/res/assets/
	OUTPUT_DIR ${PROJECT_BINARY_DIR}/res/assets/
	TEXT_FILES
		images/meta/undefined.png
		images/meta/invisible.png
		images/races/human/base/human_base_idle0.png
		images/races/human/base/human_base_idle1.png
		images/races/human/base/human_base_side0.png
		images/races/human/base/human_base_side1.png
		images/races/human/base/human_base_side2.png
		images/races/human/base/human_base_side3.png
		images/races/human/base/human_base_up0.png
		images/races/human/base/human_base_up1.png
		images/races/human/base/human_base_up2.png
		images/races/human/base/human_base_up3.png
		images/races/human/base/human_base_down0.png
		images/races/human/base/human_base_down1.png
		images/races/human/base/human_base_down2.png
		images/races/human/base/human_base_down3.png
		images/races/human/hair/long/human_hair_long_idle0.png
		images/races/human/hair/long/human_hair_long_idle1.png
		images/races/human/hair/long/human_hair_long_side0.png
		images/races/human/hair/long/human_hair_long_side1.png
		images/races/human/hair/long/human_hair_long_side2.png
		images/races/human/hair/long/human_hair_long_side3.png
		images/races/human/hair/long/human_hair_long_up0.png
		images/races/human/hair/long/human_hair_long_up1.png
		images/races/human/hair/long/human_hair_long_up2.png
		images/races/human/hair/long/human_hair_long_up3.png
		images/races/human/hair/long/human_hair_long_down0.png
		images/races/human/hair/long/human_hair_long_down1.png
		images/races/human/hair/long/human_hair_long_down2.png
		images/races/human/hair/long/human_hair_long_down3.png
		images/races/human/hair/lord/human_hair_lord_idle0.png
		images/races/human/hair/lord/human_hair_lord_idle1.png
		images/races/human/hair/lord/human_hair_lord_side0.png
		images/races/human/hair/lord/human_hair_lord_side1.png
		images/races/human/hair/lord/human_hair_lord_side2.png
		images/races/human/hair/lord/human_hair_lord_side3.png
		images/races/human/hair/lord/human_hair_lord_up0.png
		images/races/human/hair/lord/human_hair_lord_up1.png
		images/races/human/hair/lord/human_hair_lord_up2.png
		images/races/human/hair/lord/human_hair_lord_up3.png
		images/races/human/hair/lord/human_hair_lord_down0.png
		images/races/human/hair/lord/human_hair_lord_down1.png
		images/races/human/hair/lord/human_hair_lord_down2.png
		images/races/human/hair/lord/human_hair_lord_down3.png
		images/races/human/hair/prince/human_hair_prince_idle0.png
		images/races/human/hair/prince/human_hair_prince_idle1.png
		images/races/human/hair/prince/human_hair_prince_side0.png
		images/races/human/hair/prince/human_hair_prince_side1.png
		images/races/human/hair/prince/human_hair_prince_side2.png
		images/races/human/hair/prince/human_hair_prince_side3.png
		images/races/human/hair/prince/human_hair_prince_up0.png
		images/races/human/hair/prince/human_hair_prince_up1.png
		images/races/human/hair/prince/human_hair_prince_up2.png
		images/races/human/hair/prince/human_hair_prince_up3.png
		images/races/human/hair/prince/human_hair_prince_down0.png
		images/races/human/hair/prince/human_hair_prince_down1.png
		images/races/human/hair/prince/human_hair_prince_down2.png
		images/races/human/hair/prince/human_hair_prince_down3.png
		images/races/human/eyes/dot/human_eyes_dot_idle0.png
		images/races/human/eyes/dot/human_eyes_dot_idle1.png
		images/races/human/eyes/dot/human_eyes_dot_side0.png
		images/races/human/eyes/dot/human_eyes_dot_side1.png
		images/races/human/eyes/dot/human_eyes_dot_side2.png
		images/races/human/eyes/dot/human_eyes_dot_side3.png
		images/races/human/eyes/dot/human_eyes_dot_down0.png
		images/races/human/eyes/dot/human_eyes_dot_down1.png
		images/races/human/eyes/dot/human_eyes_dot_down2.png
		images/races/human/eyes/dot/human_eyes_dot_down3.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_idle0.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_idle1.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_side0.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_side1.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_side2.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_side3.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_up0.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_up1.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_up2.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_up3.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_down0.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_down1.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_down2.png
		images/races/human/equipment/chest/elementalrobes/human_equipment_chest_elementalrobes_down3.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_idle0.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_idle1.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_side0.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_side1.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_side2.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_side3.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_up0.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_up1.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_up2.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_up3.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_down0.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_down1.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_down2.png
		images/races/human/equipment/chest/shirt/human_equipment_chest_shirt_down3.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_idle0.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_idle1.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_side0.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_side1.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_side2.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_side3.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_up0.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_up1.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_up2.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_up3.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_down0.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_down1.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_down2.png
		images/races/human/equipment/chest/warrior/human_equipment_chest_warrior_down3.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_idle0.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_side0.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_side1.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_side2.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_side3.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_up0.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_up1.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_up2.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_up3.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_down0.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_down1.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_down2.png
		images/races/human/equipment/feet/dot/human_equipment_feet_dot_down3.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_idle0.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_idle1.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_side0.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_side1.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_side2.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_side3.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_up0.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_up1.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_up2.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_up3.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_down0.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_down1.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_down2.png
		images/races/human/equipment/helm/full/human_equipment_helm_full_down3.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_idle0.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_idle1.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_side0.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_side1.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_side2.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_side3.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_up0.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_up1.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_up2.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_up3.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_down0.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_down1.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_down2.png
		images/races/human/equipment/helm/headband/human_equipment_helm_headband_down3.png
		fonts/LucidaSansRegular.ttf
)

tz_add_executable(
	TARGET rn
	SOURCES
		src/main.cpp
)

target_link_libraries(rn PRIVATE rnlib stb)
